<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>츼lbum Rom치ntico</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #fbeaff, #fff0f6);
      margin: 0;
      color: #333;
    }
    header {
      text-align: center;
      padding: 30px 10px;
      background: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-bottom: 3px solid #f0c3f7;
    }
    h1 {
      color: #b83280;
      font-size: 2.2rem;
    }
    .container {
      max-width: 1000px;
      margin: 40px auto;
      padding: 30px;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }
    .btn {
      background: linear-gradient(135deg, #ff5ecd, #b83280);
      color: #fff;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    .btn:hover {
      background: linear-gradient(135deg, #ff4bb2, #a42b70);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    input, textarea, select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 1rem;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 25px;
    }
    .item {
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      background: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
    }
    .item:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 20px rgba(0,0,0,0.15);
    }
    .item img, .item video {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    /* Lightbox Modal */
    .lightbox {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.9);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }
    .lightbox.active {
      opacity: 1;
      visibility: visible;
    }
    .lightbox-content img, .lightbox-content video {
      max-width: 90%;
      max-height: 80vh;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255,255,255,0.2);
    }
    .close-btn {
      position: absolute;
      top: 20px;
      right: 40px;
      font-size: 40px;
      color: #fff;
      cursor: pointer;
      transition: 0.3s;
    }
    .close-btn:hover {color: #ff4bb2;}
  </style>
</head>
<body>
  <header>
    <h1>游눘 Nuestro 츼lbum Rom치ntico 游눘</h1>
    <p>Un lugar seguro para nuestros recuerdos m치s lindos</p>
  </header>

  <div class="container">
    <div id="pinSection">
      <h2>Acceso privado</h2>
      <input type="password" id="pinInput" placeholder="PIN (4-8 d칤gitos)">
      <button id="loginBtn" class="btn">Entrar</button>
      <button id="createPinBtn" class="btn">Crear PIN</button>
      <p id="pinMsg"></p>
    </div>

    <div id="albumSection" style="display:none;">
      <h2>Mis Galer칤as</h2>
      <input type="text" id="galleryName" placeholder="Nombre de galer칤a (ej: T칰 y Yo)">
      <button id="createGallery" class="btn">Crear galer칤a</button>
      <select id="gallerySelect"></select>
      <textarea id="description" placeholder="Descripci칩n"></textarea>
      <input type="file" id="fileInput" multiple accept="image/*,video/*">
      <button id="uploadBtn" class="btn">Subir</button>
      <div class="gallery" id="gallery"></div>
    </div>
  </div>

  <div id="lightbox" class="lightbox">
    <span id="closeLightbox" class="close-btn">&times;</span>
    <div class="lightbox-content" id="lightboxContent"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAMlpw4MGaa4XqHKG--NZYKIh6yM8-NuqE",
      authDomain: "galeria-5e025.firebaseapp.com",
      projectId: "galeria-5e025",
      storageBucket: "galeria-5e025.appspot.com",
      messagingSenderId: "273503286623",
      appId: "1:273503286623:web:c49f7fba6c9d550ea232ea",
      measurementId: "G-34KZ77TZ8B"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();
    const serverTs = firebase.firestore.FieldValue.serverTimestamp;

    const pinInput = document.getElementById('pinInput');
    const pinMsg = document.getElementById('pinMsg');
    const loginBtn = document.getElementById('loginBtn');
    const createPinBtn = document.getElementById('createPinBtn');
    const pinSection = document.getElementById('pinSection');
    const albumSection = document.getElementById('albumSection');

    function simpleHash(str){ let h=0; for(let i=0;i<str.length;i++){h=(h<<5)-h+str.charCodeAt(i); h|=0;} return String(h); }
    async function getPinDoc(){ const ref=db.collection('shared').doc('pin'); const snap=await ref.get(); return {ref,snap}; }

    loginBtn.onclick = async ()=>{
      const val=pinInput.value.trim(); if(!val){pinMsg.textContent='Escribe el PIN';return;}
      const {snap}=await getPinDoc(); if(!snap.exists){pinMsg.textContent='No hay PIN creado';return;}
      if(snap.data().pinHash===simpleHash(val)){
        pinSection.style.display='none'; albumSection.style.display='block'; loadGalleries();
      } else pinMsg.textContent='PIN incorrecto';
    };

    createPinBtn.onclick = async ()=>{
      const val=pinInput.value.trim(); if(!/^[0-9]{4,8}$/.test(val)){pinMsg.textContent='PIN inv치lido';return;}
      const {ref}=await getPinDoc(); await ref.set({pinHash:simpleHash(val),createdAt:serverTs()});
      pinMsg.textContent='PIN creado'; pinSection.style.display='none'; albumSection.style.display='block'; loadGalleries();
    };

    const gallerySelect=document.getElementById('gallerySelect');
    const galleryName=document.getElementById('galleryName');
    const createGallery=document.getElementById('createGallery');
    const uploadBtn=document.getElementById('uploadBtn');
    const fileInput=document.getElementById('fileInput');
    const galleryDiv=document.getElementById('gallery');

    const lightbox=document.getElementById('lightbox');
    const lightboxContent=document.getElementById('lightboxContent');
    const closeLightbox=document.getElementById('closeLightbox');

    closeLightbox.onclick=()=>{
      lightbox.classList.remove('active');
      lightboxContent.innerHTML='';
    };

    async function loadGalleries(){
      const q=await db.collection('galleries').get();
      gallerySelect.innerHTML='';
      q.forEach(doc=>{
        const opt=document.createElement('option');
        opt.value=doc.id;
        opt.textContent=doc.data().name;
        gallerySelect.appendChild(opt);
      });
    }

    createGallery.onclick = async ()=>{
      const name=galleryName.value.trim(); if(!name) return alert('Escribe un nombre');
      await db.collection('galleries').add({name,createdAt:serverTs()});
      galleryName.value=''; loadGalleries();
    };

    uploadBtn.onclick = async ()=>{
      const galleryId=gallerySelect.value; if(!galleryId) return alert('Selecciona una galer칤a');
      const files=fileInput.files; if(!files.length) return alert('Selecciona archivos');
      for(const f of files){
        const path=`shared/${galleryId}/${Date.now()}_${f.name}`;
        const ref=storage.ref().child(path);
        const snap=await ref.put(f);
        const url=await snap.ref.getDownloadURL();
        await db.collection('items').add({galleryId,url,name:f.name,type:f.type.startsWith('video')?'video':'image',createdAt:serverTs()});
      }
      fileInput.value=''; loadGalleryItems(galleryId);
    };

    gallerySelect.onchange=()=>loadGalleryItems(gallerySelect.value);

    async function loadGalleryItems(id){
      const q=await db.collection('items').where('galleryId','==',id).orderBy('createdAt','desc').get();
      galleryDiv.innerHTML='';
      q.forEach(doc=>{
        const d=doc.data();
        const el=document.createElement('div'); el.className='item';
        el.innerHTML=d.type==='video'?`<video src="${d.url}" controls></video>`:`<img src="${d.url}">`;
        el.onclick=()=>{
          lightbox.classList.add('active');
          lightboxContent.innerHTML=d.type==='video'?`<video src="${d.url}" controls autoplay></video>`:`<img src="${d.url}">`;
        };
        galleryDiv.appendChild(el);
      });
    }
  </script>
</body>
</html>
